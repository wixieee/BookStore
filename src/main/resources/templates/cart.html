<!DOCTYPE html>
<html lang="uk" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{base :: layout(~{::title}, ~{::main}, ~{::links}, ~{})}">

<head>
    <title th:text="#{header.cart} + ' — ' + #{header.logo}">Кошик - BookStore</title>
    <th:block th:fragment="links">
        <link rel="stylesheet" th:href="@{/css/cart.css}">
    </th:block>
</head>

<body>
<main th:fragment="main">
    <div class="cart-layout">

        <div class="cart-header-row">
            <h1 class="cart-page-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="9" cy="21" r="1"></circle>
                    <circle cx="20" cy="21" r="1"></circle>
                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                </svg>
                <span th:text="#{header.cart}">Мій кошик</span>
                <span class="cart-count-badge" th:if="${!cart.cartItems.isEmpty()}"
                      th:text="${cart.cartItems.size()}">3</span>
            </h1>
        </div>

        <div th:if="${cart.cartItems.isEmpty()}" class="cart-empty-state">
            <div class="cart-empty-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M23 1l-2.02 9.06a2 2 0 0 1-1.95 1.57h-9.78a2 2 0 0 1-1.95-1.57L4.93 1H1"></path>
                    <path d="M10 16a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"></path>
                    <path d="M20 16a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"></path>
                </svg>
            </div>
            <h2 th:text="#{cart.empty}">Ваш кошик порожній</h2>
            <p th:text="#{cart.empty.muted}" class="cart-p-empty">Схоже, ви ще нічого не додали.</p>
            <a href="/" class="btn btn-primary" style="padding: 0.875rem 2rem;">
                <span th:text="#{home.back}">Перейти до покупок</span>
            </a>
        </div>

        <div th:unless="${cart.cartItems.isEmpty()}" class="cart-card">

            <div class="cart-list">
                <div th:each="item : ${cart.cartItems}" class="cart-item">

                    <img th:src="${item.book.imagePath != null ? item.book.imagePath : '/img/book-placeholder.png'}"
                         alt="Cover" class="cart-item-img">

                    <div class="cart-item-info">
                        <span class="cart-item-title" th:text="${item.book.name}">Назва книги</span>
                        <span class="cart-item-author" th:text="${item.book.author}">Автор</span>
                        <span class="cart-item-unit-price"
                              th:text="${item.book.price} + ' ' + #{currency} + ' / шт.'">250 грн / шт.</span>
                    </div>

                    <form th:action="@{/cart/update}" method="post" class="cart-qty-form">
                        <input type="hidden" name="cartItemId" th:value="${item.id}">

                        <input type="number" name="quantity"
                               class="cart-qty-input"
                               th:value="${item.quantity}"
                               min="1" max="99"
                               onchange="this.form.submit()"
                               aria-label="Quantity">
                    </form>

                    <div class="cart-item-subtotal">
                        <span th:text="${item.book.price * item.quantity} + ' ' + #{currency}">500 грн</span>
                    </div>

                    <form th:action="@{/cart/remove}" method="post">
                        <input type="hidden" name="cartItemId" th:value="${item.id}">
                        <button type="submit" class="btn-remove" title="Remove item">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="3 6 5 6 21 6"></polyline>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                <line x1="14" y1="11" x2="14" y2="17"></line>
                            </svg>
                        </button>
                    </form>
                </div>
            </div>

            <div class="cart-footer">
                <div class="cart-total-block">
                    <span class="cart-total-label" th:text="#{cart.total}">Разом до сплати:</span>
                    <span class="cart-total-value" th:text="${totalPrice} + ' ' + #{currency}">1250 грн</span>
                </div>

                <div class="cart-actions">
                    <form th:action="@{/cart/clear}" method="post">
                        <button type="submit" class="btn-clear" th:text="#{cart.clear}">Очистити кошик</button>
                    </form>

                    <form th:action="@{/orders/create}" method="post">
                        <button type="submit" class="btn btn-primary btn-checkout">
                            <span th:text="#{cart.checkout}">Оформити замовлення</span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
                        </button>
                    </form>
                </div>
            </div>
        </div>

    </div>
</main>
</body>
</html>